<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audiobook App</title>
<style>
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
    color: #eee; 
    margin: 0; 
    padding: 20px; 
    min-height: 100vh;
  }
  
  .container { 
    max-width: 900px; 
    margin: 20px auto; 
    padding: 20px; 
    background: rgba(0, 0, 0, 0.7); 
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
  }
  
  h1 {
    text-align: center;
    color: #fff;
    margin-bottom: 30px;
    font-size: 2.5rem;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
  }
  
  .book-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }
  
  .book-card {
    background: linear-gradient(145deg, #2a2a2a, #222);
    border-radius: 12px;
    padding: 16px;
    cursor: pointer;
    text-align: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  
  .book-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.4);
  }
  
  .book-card img {
    width: 100px;
    height: 140px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  }
  
  .book-card h3 {
    margin: 0;
    font-size: 1.1rem;
    color: #fff;
  }
  
  .page {
    background: #333;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    line-height: 1.6;
    font-size: 1.1rem;
  }
  
  .controls {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
    justify-content: center;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
  }
  
  button {
    padding: 10px 18px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  button:hover {
    transform: scale(1.05);
  }
  
  .back-btn {
    background: #ff5722;
    color: white;
  }
  
  .back-btn:hover {
    background: #e64a19;
  }
  
  .prev-btn {
    background: #2196F3;
    color: white;
  }
  
  .prev-btn:hover {
    background: #1976D2;
  }
  
  .next-btn {
    background: #4CAF50;
    color: white;
  }
  
  .next-btn:hover {
    background: #388E3C;
  }
  
  .library-btn {
    background: #9C27B0;
    color: white;
  }
  
  .library-btn:hover {
    background: #7B1FA2;
  }
  
  select {
    padding: 8px 12px;
    border-radius: 6px;
    background: #333;
    color: white;
    border: 1px solid #555;
  }
  
  audio {
    width: 100%;
    margin-top: 15px;
    border-radius: 8px;
    background: #333;
  }
  
  .page-indicator {
    text-align: center;
    margin: 10px 0;
    font-size: 1.1rem;
    color: #ccc;
  }
  
  .book-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
  }
  
  .book-header img {
    width: 80px;
    height: 110px;
    object-fit: cover;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  }
</style>
</head>
<body>
<div class="container">
  <h1>Audiobook Library</h1>
  <div id="bookList">
    <div class="book-grid">
      <div class="book-card" onclick="openBook(0)">
        <img src="https://i.postimg.cc/L6BLs8qX/logo-optimized.png" alt="认识人性诱惑">
        <h3>认识人性诱惑</h3>
      </div>
      <div class="book-card" onclick="openBook(1)">
        <img src="https://via.placeholder.com/100x140.png?text=Book+2" alt="Book Two">
        <h3>Book Two</h3>
      </div>
    </div>
  </div>
  
  <div id="bookContent" hidden>
    <button class="back-btn" onclick="backToLibrary()">⬅ Back to Library</button>
    
    <div class="book-header">
      <img id="bookCover" src="" alt="Book Cover">
      <h2 id="bookTitle"></h2>
    </div>
    
    <div class="page-indicator">
      Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
    </div>
    
    <div id="pages"></div>
    
    <div class="controls">
      <button class="prev-btn" onclick="prevPage()">Previous Page</button>
      <button class="next-btn" onclick="nextPage()">Next Page</button>
      <label>Speed: 
        <select id="speedSelect">
          <option value="0.75">0.75x</option>
          <option value="1" selected>1x</option>
          <option value="1.25">1.25x</option>
          <option value="1.5">1.5x</option>
          <option value="2">2x</option>
        </select>
      </label>
    </div>
    
    <audio id="audioPlayer" controls></audio>
  </div>
</div>

<script>
// ===== DATA STRUCTURE =====
let books = [
  {
    title: "认识人性诱惑",
    logo: "https://i.postimg.cc/L6BLs8qX/logo-optimized.png",
    audioFiles: ["https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3"], // using sample audio
    text: `人性往往会在“诱惑”前动摇，无论是金钱、欲望、权力还是虚荣。想要避免被诱惑带走，需要既理解心理机制，又建立防护习惯。我给你几个层次的思考和做法：

1. 认识诱惑的本质

诱惑本质上是短期满足与长期利益之间的冲突。大脑更倾向于立即获得奖励，而不是等待未来的更大回报。这种倾向在心理学上称为"即时满足偏好"。

2. 了解自己的弱点

每个人都有不同的诱惑弱点。对一些人来说是美食，对另一些人可能是购物、游戏或社交媒体。了解自己的特定弱点可以帮助你制定更有针对性的抵抗策略。

3. 建立防护机制

一旦了解了自己的弱点，就可以建立防护机制。例如：删除购物APP、设置屏幕使用时间、避免携带大量现金等。环境设计比单纯依靠意志力更有效。

4. 培养延迟满足的能力

通过练习延迟满足，可以增强自我控制能力。从小的练习开始，比如等待10分钟再吃零食，逐渐延长等待时间。

5. 寻找替代满足

找到健康的替代活动来获得满足感，如运动、阅读或学习新技能。这些活动不仅能提供满足感，还能带来长期益处。

记住，抵抗诱惑不是一次性的战斗，而是需要持续练习的技能。每次成功抵抗诱惑都会强化你的自控能力。`
  },
  {
    title: "Book Two",
    logo: "https://via.placeholder.com/100x140.png?text=Book+2",
    audioFiles: ["https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3"],
    text: `Book Two content goes here. Split into pages automatically.

这是第二本书的内容示例。这本书将讨论不同的主题，提供更多有价值的见解和信息。

每一页的内容将根据字符限制自动分割，确保阅读体验流畅。

您可以使用底部的控制按钮在不同页面之间导航，也可以调整音频播放速度以适应您的听力偏好。

阅读和学习是一个持续的过程，我们希望这个应用程序能够帮助您更有效地获取知识。

请享受阅读的乐趣，随时使用播放功能来听书而不是阅读。`
  }
];

const PAGE_CHAR_LIMIT = 400; // adjust to how many chars fit in one page
let currentBook = null;
let pages = [];
let currentPageIndex = 0;
let audioPlayer = null;

// ===== DISPLAY BOOKS =====
const bookList = document.getElementById("bookList");
const bookContent = document.getElementById("bookContent");
const pagesDiv = document.getElementById("pages");
const bookTitleEl = document.getElementById("bookTitle");
const bookCoverEl = document.getElementById("bookCover");
const currentPageEl = document.getElementById("currentPage");
const totalPagesEl = document.getElementById("totalPages");
const speedSelect = document.getElementById("speedSelect");

// Initialize audio player
function initAudioPlayer() {
  audioPlayer = document.getElementById("audioPlayer");
  
  // When audio ends, automatically go to next page if available
  audioPlayer.addEventListener('ended', () => {
    if (currentPageIndex < pages.length - 1) {
      nextPage();
    }
  });
  
  // Update playback rate when speed selection changes
  speedSelect.addEventListener('change', ()=>{
    if (audioPlayer) {
      audioPlayer.playbackRate = parseFloat(speedSelect.value);
    }
  });
}

function openBook(index) {
  currentBook = books[index];
  pages = splitPages(currentBook.text);
  currentPageIndex = 0;
  bookList.hidden = true;
  bookContent.hidden = false;
  bookTitleEl.textContent = currentBook.title;
  bookCoverEl.src = currentBook.logo;
  currentPageEl.textContent = currentPageIndex + 1;
  totalPagesEl.textContent = pages.length;
  renderPage();
}

function backToLibrary() {
  bookContent.hidden = true;
  bookList.hidden = false;
  if (audioPlayer) {
    audioPlayer.pause();
  }
}

// ===== PAGE LOGIC =====
function splitPages(text) {
  const paragraphs = text.split('\n\n'); // Split by paragraphs
  let result = [];
  
  paragraphs.forEach(para => {
    if (para.length <= PAGE_CHAR_LIMIT) {
      result.push(para);
    } else {
      // If paragraph is too long, split into sentences
      let sentences = para.split(/(?<=[。.?!])\s+/);
      let currentPage = "";
      
      sentences.forEach(sentence => {
        if (currentPage.length + sentence.length <= PAGE_CHAR_LIMIT) {
          currentPage += sentence + " ";
        } else {
          if (currentPage.length > 0) {
            result.push(currentPage);
          }
          currentPage = sentence + " ";
        }
      });
      
      if (currentPage.length > 0) {
        result.push(currentPage);
      }
    }
  });
  
  return result;
}

function renderPage() {
  pagesDiv.innerHTML = `<div class="page">${pages[currentPageIndex]}</div>`;
  currentPageEl.textContent = currentPageIndex + 1;
  
  // Load corresponding audio file if available
  if (currentBook.audioFiles[currentPageIndex]) {
    // Store current playback time and rate
    const currentTime = audioPlayer.currentTime;
    const currentRate = audioPlayer.playbackRate;
    const wasPlaying = !audioPlayer.paused;
    
    // Change source
    audioPlayer.src = currentBook.audioFiles[currentPageIndex];
    audioPlayer.playbackRate = parseFloat(speedSelect.value);
    
    // After metadata is loaded, set time and play if was playing
    audioPlayer.onloadedmetadata = function() {
      if (wasPlaying) {
        audioPlayer.currentTime = 0; // Start from beginning of new page
        audioPlayer.play().catch(e => console.log("Auto-play prevented:", e));
      }
    };
  } else {
    audioPlayer.src = "";
  }
}

function nextPage() {
  if (currentPageIndex < pages.length - 1) {
    currentPageIndex++;
    renderPage();
    
    // Auto-play when moving to next page
    if (audioPlayer.src) {
      audioPlayer.play().catch(e => console.log("Auto-play prevented:", e));
    }
  }
}

function prevPage() {
  if (currentPageIndex > 0) {
    currentPageIndex--;
    renderPage();
    
    // Auto-play when moving to previous page
    if (audioPlayer.src) {
      audioPlayer.play().catch(e => console.log("Auto-play prevented:", e));
    }
  }
}

// Initialize when page loads
window.onload = function() {
  initAudioPlayer();
};
</script>
</body>
</html>